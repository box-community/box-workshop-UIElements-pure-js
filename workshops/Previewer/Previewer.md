# Previewer
The Box Content Preview UI Element allows developers to embed high quality and interactive previews of Box files in their desktop or mobile web application. The library fetches information about the file and its converted representations through the Box API, chooses the appropriate viewer for the file type, dynamically loads the necessary static assets and file representations, and finally renders the file. This UI Element also allows previews of multiple files to be loaded in the same container and exposes arrows to navigate between those files.

Full documentation can be found [here](https://developer.box.com/guides/embed/ui-elements/preview/).

## Exercises

### Simple Previewer with some options
In your box account navigate to the `UIE Samples`, and get the file id for `Document (PDF).pdf` file:
![Alt text](/images/preview_file_id.png)
In my case the file id is `1280655635230`.

Create a `previewer.js` file under the `js` folder of the project and add the following code:
```javascript
var accessToken = 'YOUR DEVELOPER ACCESS TOKEN';
var file_id = '1280655635230';

var options = {
    "container": ".previewer",
    "header": "light",
    "logoUrl": "box",
    "hasHeader": true,
    "showDownload": true,
}

var contentPreviewer = new Box.Preview();
console.log('Content Previewer:', contentPreviewer);

contentPreviewer.show(file_id, accessToken, options);
```
Point your browser to http://localhost:8000, and navigate to the Uploader. You should see something like this:
![Alt text](/images/previewer.png)

### Previewer with multiple files
Collect a few more file id's from your Box account and add them to the `previewer.js` file:
```javascript
var file_list = [
    '1280655635230',
    '1280653959899',
    '1280647367073',
    '1280645692624'
]

var options = {
    ...
    "collection": file_list,
}
```
You should see something angle brackets that will allow the user to preview the multiple files:
![Alt text](/images/previewer_multi_files.png)

### Implementing listeners
The Previewer UI Element allows you to implement listeners for the different events that it fires.

Edit the `previewer.js` file and add the following code ***before the `contentPreviewer.show` line***:
```javascript
contentPreviewer.addListener('viewer', previewerViewer);
contentPreviewer.addListener('load', previewerLoad);
contentPreviewer.addListener('navigate', previewerNavigate);
contentPreviewer.addListener('notification', previewerNotification);
contentPreviewer.addListener('viewerevent', previewerViewerEvent);

console.log('Content Previewer:', contentPreviewer);

function previewerViewer(viewer) {
    console.log('viewer object:', viewer);
}

function previewerLoad(e) {
    console.log('load:', e);
    sendEventToServer('load', e.file);
}

function previewerNavigate(e) {
    console.log('navigate:', e);
    sendEventToServer('navigate', e);
}

function previewerNotification(e) {
    console.log('notification:', e);
    sendEventToServer('notification', e);
}

function previewerViewerEvent(e) {
    console.log('viewer event:', e);
    sendEventToServer('viewerevent', e);
}


function sendEventToServer(eventType, e) {

    var localData = {
        eventType: eventType,
        e: e
    };

    // $.ajax({
    //     url: "//localhost:8000/events",
    //     type: 'POST',
    //     data: JSON.stringify(localData),
    //     contentType: 'application/json;charset=UTF-8',
    // });
};
```
To see this working open the browser console and you'll see the events generated by the Previewer UI Element:
![Alt text](/images/previewer_evets.png)

### Extra credit
* The previewer also supports a side bar, see if you can implement it.

## Scopes
Below are a set of UI Element-specific scopes to go alongside Downscoping. These allow developers to enable/disable UI controls on the Content Explorer by configuring the appropriate scopes on the downscoped token. To learn more, see [Dedicated Scopes for Box UI Elements](https://developer.box.com/guides/api-calls/permissions-and-errors/scopes/).


* Base Scope
    * **base_preview**	Allows the user to preview the file, nothing else
* Feature Scopes
    * **item_download**	Allows downloading/printing the content from the generated preview
    * **annotation_edit**	Allow user to edit annotations (delete). 
    Note: For highlight annotations to work, the text layer on the document needs to be enabled for the user. Text layer is disabled for all users that don't have download permissions on the file. To enable highlight annotations for a user, please ensure they have download permissions on the file.
    * **annotation_view_all**	Allows user to view all users' annotations.
    * **annotation_view_self**	Allows user to view their own annotations only.